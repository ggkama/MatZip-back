<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kh.matzip.store.model.dao.StoreMapper">

  <!-- 매장 등록 -->
  <insert id="insertStore" parameterType="com.kh.matzip.store.model.dto.StoreDTO">
    <selectKey keyProperty="storeNo" resultType="long" order="BEFORE">
      SELECT SEQ_STORE_NO.NEXTVAL FROM DUAL
    </selectKey>
    INSERT INTO TB_STORE 
                      (
                        STORE_NO
                      , OWNER_NO
                      , STORE_NAME
                      , STORE_PHONE
                      , STORE_ADDRESS1
                      , STORE_ADDRESS2
                      , CATEGORY_ADDRESS
                      , CATEGORY_FOODTYPE
                      , OPEN_TIME
                      , CLOSE_TIME
                      , CREATE_DATE
                      , MODIFY_DATE
                      , IS_DELETE
                      , COUNT
                      , STORE_IMG
                    )
            VALUES (
                      #{storeNo}
                    , #{ownerNo}
                    , #{storeName}
                    , #{storePhone}
                    , #{storeAddress1}
                    , #{storeAddress2}
                    , #{categoryAddress}
                    , #{categoryFoodtype}
                    , #{openTime}
                    , #{closeTime}
                    , SYSDATE
                    , SYSDATE
                    , #{isDelete}
                    , #{count}
                    , #{storeImg}
        )
  </insert>

  <!-- 이미지 등록 -->
  <insert id="insertStoreImage">
    <selectKey keyProperty="imageNo" resultType="long" order="BEFORE">
      SELECT SEQ_STORE_IMAGE.NEXTVAL 
                                  FROM DUAL
    </selectKey>
    INSERT INTO 
      TB_STORE_IMAGE (
                      IMAGE_NO
                    , STORE_NO
                    , IMAGE
                      )
              VALUES (
                      #{imageNo}
                    , #{storeNo}
                    , #{image}
            )
  </insert>

  <!-- 편의시설 등록 -->
  <insert id="insertStoreConvenience">
    <selectKey keyProperty="convenienceNo" resultType="long" order="BEFORE">
      SELECT SEQ_CONVENIENCE_NO.NEXTVAL FROM DUAL
    </selectKey>
    INSERT INTO 
      TB_CONVENIENCE 
                    (
                      CONVENIENCE_NO
                    , STORE_NO
                    , CONVENIENCE
                    )
            VALUES (
                      #{convenienceNo}
                    , #{storeNo}
                    , #{convenience}
                    )
  </insert>

  <!-- 매장 쉬는 날 등록 -->
  <insert id="insertDayOff">
    INSERT INTO TB_OFF_DAY (
      STORE_NO,
      OFF_DAY
    ) VALUES (
      #{storeNo},
      #{offDay}
    )
  </insert>

  <!-- 매장 중복확인 -->
  <select id="countStoreByOwnerAndName" resultType="int">
  SELECT COUNT(STORE_NO)
  FROM TB_STORE
  WHERE OWNER_NO = #{ownerNo}
    AND STORE_NAME = #{storeName}
    AND IS_DELETE = 'N'
  </select>

</mapper>